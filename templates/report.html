<!-- Purpose: report template -->
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Entry Exit Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/flatly/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <link href="/static/css/flatpickr.min.css" rel="stylesheet">
    <script src="/static/js/flatpickr.min.js"></script>
</head>
<body class="vms-body" data-plate-enabled="{{ 'true' if plate_enabled else 'false' }}">
<!-- ===== Section: Navbar ===== -->
{% include 'partials/header.html' %}
<!-- ===== Section: Main Content ===== -->
    <div class="container mt-4">
    <h1 class="mb-4">Entry Exit Report</h1>
    {% if error_message %}
    <div class="alert alert-danger">{{ error_message }}</div>
    {% elif no_data %}
    <div class="alert alert-info">{{ no_data_message }}</div>
    {% endif %}
    <form id="rangeForm" class="row gy-2 gx-3 align-items-center flex-wrap mb-4">
        <div class="col-md-auto"><input type="text" id="range" class="form-control" placeholder="Select range"></div>
        <div class="col-md-auto">
            <select id="quick" class="form-select">
                <option value="" {{ 'selected' if selected_quick=='' else '' }}>Custom</option>
                <option value="today" {{ 'selected' if selected_quick=='today' else '' }}>Today</option>
                <option value="week" {{ 'selected' if selected_quick=='week' else '' }}>Last 7 days</option>
                <option value="month" {{ 'selected' if selected_quick=='month' else '' }}>This Month</option>
            </select>
        </div>
        <div class="col-md-auto">
            <select id="type" class="form-select">
                <option value="person" {{ 'selected' if selected_type=='person' else '' }}>Person Report</option>
                {% if vehicle_enabled %}<option value="vehicle" {{ 'selected' if selected_type=='vehicle' else '' }}>Vehicle Report</option>{% endif %}
            </select>
        </div>
        <div class="col-md-auto">
            <select id="view" class="form-select">
                <option value="table" selected>Table View</option>
                <option value="graph">Graph View</option>
            </select>
        </div>
        <div class="col-md-auto">
            <select id="camera" class="form-select">
                <option value="">All Cameras</option>
                {% for cam in cameras %}{% if include_archived or not cam.archived %}<option value="{{cam.id}}">{{cam.name}}</option>{% endif %}{% endfor %}
            </select>
        </div>
        <div class="col-md-auto">
            <select id="label" class="form-select">
                <option value="">All Labels</option>
                {% for lbl in labels %}<option value="{{lbl}}">{{lbl.replace('_',' ').title()}}</option>{% endfor %}
            </select>
        </div>
        <div class="col-md-auto">
            <select id="rows" class="form-select">
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
                <option value="200">200</option>
            </select>
        </div>
        <div class="col-md-auto d-flex gap-2">
            <button type="submit" class="btn btn-primary">Load</button>
            <a href="/" class="btn btn-secondary">Back</a>
        </div>
        <input type="hidden" id="cursor" value="0">
    </form>
    <div id="errorAlert" class="alert alert-danger d-none" role="alert"></div>
    <div id="loadingSpinner" class="text-center my-3 d-none">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <div id="graphBox" class="mx-auto">
        <canvas id="reportChart" height="300"></canvas>
        <button id="downloadChart" class="btn btn-secondary mt-2">Download PNG</button>
    </div>
    <div class="table-responsive">
        <table class="table table-striped" id="tbl" style="display:none">
            <thead><tr><th>Time</th><th>Camera</th><th>Track</th><th>Direction</th><th id="labelHdr">Label</th><th>Image</th>{% if plate_enabled %}<th>Number Plate</th>{% endif %}</tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <button id="loadMoreBtn" class="btn btn-primary mt-2" style="display:none">Load more</button>
    <a id="exportLink" class="btn btn-success mt-2" href="#" download>Export</a>
</div>
{% include 'partials/footer.html' %}
<script>
  // Provide configuration for report.js
  window.reportConfig = {
    plateEnabled: document.body.dataset.plateEnabled === 'true'
  };
</script>

<script defer src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script defer src="{{ url_for('static', path='js/chart.umd.min.js') }}"></script>
<script defer src="{{ url_for('static', path='js/chartjs-plugin-datalabels.min.js') }}"></script>
<script defer src="{{ url_for('static', path='js/chartjs-plugin-zoom.min.js') }}"></script>
<script defer src="/static/js/report.js"></script>
</body>
</html>
